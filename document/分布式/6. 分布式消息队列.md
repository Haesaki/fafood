# Message Queue

MQ的应用场景：

- 服务解耦：弱
- 削峰填谷：在大流量的情况下，将短时间的大流量放到消息队列中，不然后端处理请求的同时处理过多请求 导致服务崩溃。
- 异步化的缓冲：最终一致性

思考点：能不能抗住业务最高峰的压力

- 生产端的可靠性投递
- 消费端幂等验证：避免超消费
- 高可用
- 低延迟
- 可靠性
- 堆积能力：高峰期 堆积的能力
- 扩展性

## 主流MQ

Active：传统行业，边缘系统

Rabbit：可靠性，扩展性不好

Rocket：

Kafka：

- 各个MQ性能，优缺点，相应的业务场景
- 集群架构模式，分布式，可扩展，高可用，可维护性
- 综合成本问题，集群规模，人员成本
- 未来的方向，规划，思考

### Rabbit

构架：

- 主备模式：一个主备方案，主节点挂了，从节点提供相应的业务员，和ActiveMQ利用Zookeeper做主备

  ```shell
  listen rabbitmq_cluster
  bind 0.0.0.0:5672	 
  mode tcp			# 配置TCP模式
  balance roundrobin   # 简单轮询
  server ser76 192.168.1.77 check inter 5000 rise 2 fall 2  # 均衡策略 轮询
  server ser77 192.168.1.28 backup inter 5000 rise 2 fall 2 # 备用系欸但
  ```

  

- 远程模式：数据异地容灾，单个节点处理不完的时候，转移到异地容灾节点进行处理。

- 镜像模式：消息可靠

  最经典的，保证100%数据不丢失

- 多活模式：异地容灾
